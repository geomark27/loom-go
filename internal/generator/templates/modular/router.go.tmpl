package server

import (
	"net/http"
	"time"

	"github.com/gin-gonic/gin"
)

var startTime = time.Now()

// registerHealthRoutes registra las rutas de health check
func registerHealthRoutes(router *gin.Engine) {
	api := router.Group("/api/v1")

	// Health endpoints
	api.GET("/health", healthHandler)
	api.GET("/health/ready", readyHandler)

	// Ruta raíz
	router.GET("/", rootHandler)
}

// healthHandler retorna el estado de salud del servicio
func healthHandler(c *gin.Context) {
	c.JSON(http.StatusOK, gin.H{
		"status":    "healthy",
		"timestamp": time.Now(),
		"service":   "{{.Name}}",
		"version":   "v1.1.0",
		"uptime":    time.Since(startTime).String(),
	})
}

// readyHandler retorna el estado de preparación del servicio
func readyHandler(c *gin.Context) {
	c.JSON(http.StatusOK, gin.H{
		"status":    "ready",
		"timestamp": time.Now(),
		"checks": gin.H{
			"service": "ok",
			// "database": "ok", // Cuando se implemente
			// "cache":    "ok", // Cuando se implemente
		},
	})
}

// rootHandler es el handler de la ruta raíz
func rootHandler(c *gin.Context) {
	c.JSON(http.StatusOK, gin.H{
		"message":        "¡Bienvenido a {{.Name}}!",
		"status":         "success",
		"version":        "v1.1.0",
		"architecture":   "modular",
		"generated_with": "Loom",
		"endpoints": gin.H{
			"health": "/api/v1/health",
			"users":  "/api/v1/users",
			"docs":   "/docs/API.md",
		},
	})
}
